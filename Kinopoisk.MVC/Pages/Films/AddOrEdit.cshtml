@page "{id?}"
@model Kinopoisk.MVC.Pages.Films.AddOrEditModel
@{
    var isNew = Model.Film.IsNew ?? true;
    var title = isNew ? "Create Film" : "Edit Film";
}

<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css" rel="stylesheet" />

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow-lg">
                <div class="card-header bg-warning text-dark">
                    <h4 class="mb-0">@title</h4>
                </div>
                <div class="card-body">
                    <form method="post">
                        <div class="mb-3">
                            <label asp-for="Film.Name" class="form-label"></label>
                            <input asp-for="Film.Name" class="form-control" />
                            <span asp-validation-for="Film.Name" class="text-danger"></span>
                        </div>
                        <div class="mb-3">
                            <label asp-for="Film.Poster" class="form-label"></label>
                            <input asp-for="Film.Poster" class="form-control" />
                            <span asp-validation-for="Film.Poster" class="text-danger"></span>
                        </div>
                        <div class="mb-3">
                            <label asp-for="Film.Description" class="form-label"></label>
                            <textarea asp-for="Film.Description" class="form-control" rows="5"></textarea>
                            <span asp-validation-for="Film.Description" class="text-danger"></span>
                        </div>
                        <div class="mb-3">
                            <label asp-for="Film.PublishDate" class="form-label"></label>
                            <input asp-for="Film.PublishDate" type="date" class="form-control" />
                            <span asp-validation-for="Film.PublishDate" class="text-danger"></span>
                        </div>
                        <div class="mb-3">
                            <label asp-for="Film.Duration" class="form-label"></label>
                            <input asp-for="Film.Duration" class="form-control" />
                            <span asp-validation-for="Film.Duration" class="text-danger"></span>
                        </div>
                        <div class="mb-3">
                            <label asp-for="Film.IMDBRating" class="form-label"></label>
                            <input asp-for="Film.IMDBRating" class="form-control" />
                            <span asp-validation-for="Film.IMDBRating" class="text-danger"></span>
                        </div>
                        <div class="mb-3">
                            <label asp-for="Film.Genres" class="form-label"></label>

                            <select asp-for="Film.SelectedGenreIds" class="form-select genre-select">
                                @foreach (var genre in Model.Film.Genres)
                                {
                                    <option value="@genre.GenreId" selected>
                                        @genre.Genre?.Name
                                    </option>
                                })
                            </select>

                            @for (int i = 0; i < Model.Film.Genres.Count; i++)
                            {
                                <input type="hidden" asp-for="Film.Genres[i].FilmId" />
                                <input type="hidden" asp-for="Film.Genres[i].GenreId" />
                            }

                            <span asp-validation-for="Film.Genres" class="text-danger"></span>
                            <button type="button" id="addGenreBtn" class="btn btn-sm btn-success">+ Add genre</button>
                        </div>
                        <div class="mb-3">
                            <label asp-for="Film.CountryId" class="form-label"></label>
                            <select asp-for="Film.CountryId" id="countrySelect" class="country-select form-select">
                                <option value="@Model.Film.CountryId">
                                    @Model.Film.Country?.Name
                                </option>
                            </select>
                            <span asp-validation-for="Film.CountryId" class="text-danger"></span>
                        </div>
                        <div class="mb-3">
                            <label asp-for="Film.Director" class="form-label"></label>
                            <select asp-for="Film.Director.FilmEmployeeId" id="directorSelect" class="actor-select form-select">
                                <option value="@Model.Film.Director?.FilmEmployeeId">
                                    @Model.Film.Director?.FilmEmployee?.Name
                                </option>
                            </select>
                            <input type="hidden" asp-for="Film.Director.IsDirector" value="true" />
                            <input type="hidden" asp-for="Film.Director.FilmId" value="@Model.Film.Id" />
                            <input type="hidden" asp-for="Film.Director.Role" value="@(Model.Film.Director?.Role ?? 0)" />
                            <span asp-validation-for="Film.Director" class="text-danger"></span>
                        </div>
                        <div class="mb-3">
                            <label asp-for="Film.Actors" class="form-label"></label>

                            <select asp-for="Film.SelectedActorIds" class="form-select actor-select">
                                @foreach (var actor in Model.Film.Actors)
                                {
                                    <option value="@actor.FilmEmployeeId" selected>
                                        @actor.FilmEmployee?.Name
                                    </option>
                                }
                            </select>


                            <div id="actorRolesContainer">
                                @for (int i = 0; i < Model.Film.Actors.Count; i++)
                                {
                                    <input type="hidden" asp-for="Film.Actors[@i].FilmId" value="@Model.Film.Id" />
                                    <input type="hidden" asp-for="Film.Actors[@i].FilmEmployeeId" value="@Model.Film.Actors[i].FilmEmployeeId" />
                                    <input type="hidden" asp-for="Film.Actors[@i].IsDirector" value="false" />
                                }
                            </div>

                            <input type="hidden" id="filmId" value="@Model.Film.Id" />

                            <span asp-validation-for="Film.Actors" class="text-danger"></span>
                            <button type="button" id="addActorBtn" class="btn btn-sm btn-success">+ Add actor</button>
                        </div>

                        <input type="hidden" asp-for="Film.Id" />
                        <input type="hidden" asp-for="Film.IsNew" />

                        <div class="d-flex justify-content-between mt-4">
                            <button type="submit" class="btn btn-outline-warning">
                                @(isNew ? "Create" : "Update")
                            </button>
                            <a asp-page="Index" class="btn btn-outline-secondary">Cancel</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts{
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="~/js/Films/addOrEdit.js"></script>
}